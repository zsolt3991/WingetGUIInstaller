<Page x:Class="WingetGUIInstaller.Pages.UpgradePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition />
            <RowDefinition Height="100" />
            <RowDefinition Height="50" />
        </Grid.RowDefinitions>

        <RelativePanel Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <TextBlock Name="PageTitle"
                       Margin="5" HorizontalAlignment="Left" FontSize="24" RelativePanel.AlignLeftWithPanel="True"
                       Text="Update Packages" />
            <TextBox Name="FilterText" Width="200"
                     Margin="5" FontSize="14" PlaceholderText="Filter Results" RelativePanel.LeftOf="RefreshContent"
                     Text="{x:Bind ViewModel.FilterText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <Button Name="RefreshContent"
                    Margin="5" HorizontalAlignment="Right"
                    Command="{x:Bind ViewModel.RefreshCommand}"
                    Content="&#xE149;"
                    FontFamily="{StaticResource SymbolThemeFontFamily}"
                    FontSize="20" RelativePanel.AlignRightWithPanel="True" />
        </RelativePanel>

        <controls:Loading Name="LoadingWidget"
                          Grid.Row="0" Grid.RowSpan="4" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                          HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" Canvas.ZIndex="99"
                          IsLoading="{x:Bind ViewModel.IsLoading, Mode=OneWay}">
            <Grid>
                <Border HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                        Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                        Opacity="0.75" />
                <Border Width="120" Height="120"
                        HorizontalAlignment="Center" VerticalAlignment="Center" Background="Black" CornerRadius="40"
                        Opacity="1">
                    <StackPanel VerticalAlignment="Center" Orientation="Vertical">
                        <ProgressRing Width="50" Height="50"
                                      HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
                        <TextBlock Margin="5" HorizontalAlignment="Center" Text="{x:Bind ViewModel.LoadingText, Mode=OneWay}" />
                    </StackPanel>
                </Border>
            </Grid>
        </controls:Loading>

        <controls:DataGrid Grid.Row="1" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" AreRowDetailsFrozen="True"
                           AreRowGroupHeadersFrozen="True" AutoGenerateColumns="False" CanUserReorderColumns="False"
                           CanUserResizeColumns="False" IsReadOnly="True"
                           ItemsSource="{x:Bind ViewModel.Packages, Mode=OneWay}"
                           SelectedItem="{x:Bind ViewModel.SelectedPackage, Mode=TwoWay}"
                           SelectionMode="Single">
            <controls:DataGrid.Resources>
                <SolidColorBrush x:Key="DataGridCellFocusVisualPrimaryBrush" Color="Transparent" />
                <SolidColorBrush x:Key="DataGridCellFocusVisualSecondaryBrush" Color="Transparent" />
            </controls:DataGrid.Resources>
            <controls:DataGrid.Columns>
                <controls:DataGridTemplateColumn Width="32">
                    <controls:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox MinWidth="20" Margin="6,0" HorizontalAlignment="Center"
                                      IsChecked="{Binding IsSelected, Mode=TwoWay}" />
                        </DataTemplate>
                    </controls:DataGridTemplateColumn.CellTemplate>
                </controls:DataGridTemplateColumn>
                <controls:DataGridTextColumn Width="2*" Binding="{Binding Name}" Header="Pacakge Name" />
                <controls:DataGridTextColumn Width="1*" Binding="{Binding Version}" Header="Installed Version" />
                <controls:DataGridTextColumn Width="1*" Binding="{Binding Available}" Header="Update Version" />
                <controls:DataGridTextColumn Width="1*" Binding="{Binding Source}" Header="Source" />
            </controls:DataGrid.Columns>
        </controls:DataGrid>

        <RelativePanel Grid.Row="3" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <TextBlock Name="SelectedText"
                       Margin="5,10,5,10" VerticalAlignment="Stretch" FontSize="16" RelativePanel.AlignLeftWithPanel="True"
                       Text="{x:Bind ViewModel.SelectedCount, Mode=OneWay}" />
            <TextBlock Margin="0,10,5,10" VerticalAlignment="Stretch" FontSize="16" RelativePanel.RightOf="SelectedText"
                       Text="package(s) selected" />
            <Button Name="UpgradeSelected"
                    Grid.Row="0" MinWidth="160" Margin="5"
                    Command="{x:Bind ViewModel.UpgradeSelectedCommand}"
                    Content="Upgrade Selected" FontSize="16"
                    IsEnabled="{x:Bind ViewModel.CanUpgradeSelected, Mode=OneWay}"
                    RelativePanel.AlignRightWithPanel="True" />
            <Button Name="UpgradeAll"
                    Grid.Row="0" MinWidth="160" Margin="5"
                    Command="{x:Bind ViewModel.UpgradeAllCommand}"
                    Content="Upgrade All" FontSize="16"
                    IsEnabled="{x:Bind ViewModel.CanUpgradeAll, Mode=OneWay}"
                    RelativePanel.LeftOf="UpgradeSelected" />
        </RelativePanel>

    </Grid>
</Page>
